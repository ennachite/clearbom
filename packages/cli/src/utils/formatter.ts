import type { Summary } from "../types.js";

export function toMarkdown(summary: Summary): string {
  const { components, licenses, risk } = summary;

  const riskEmoji =
    risk.red > 0 ? "ðŸ”´" : risk.yellow > 0 ? "ðŸŸ¡" : "ðŸŸ¢";

  return `
# ${riskEmoji} ClearBOM Security Report

| Metric | Count | Status |
| :--- | :--- | :--- |
| **Total Components** | **${components}** | â„¹ï¸ |
| ðŸŸ¢ **Low Risk** | ${risk.green} | Permissive |
| ðŸŸ¡ **Medium Risk** | ${risk.yellow} | Review Needed |
| ðŸ”´ **High Risk** | ${risk.red} | **Restricted** |

## ðŸ“œ License Breakdown
- **Permissive:** ${licenses.permissive}
- **Copyleft:** ${licenses.copyleft}
- **Proprietary:** ${licenses.proprietary}
- **Unknown:** ${licenses.unknown}

${
  summary.violations && summary.violations.length > 0
    ? `
## âŒ Policy Violations
| Component | Severity | Reason |
| :--- | :--- | :--- |
${summary.violations
  .map(
    (v) =>
      `| \`${v.component}\` | ${
        v.severity === "error" ? "ðŸ”´ Critical" : "ðŸŸ¡ Warning"
      } | ${v.reason} |`
  )
  .join("\n")}
`
    : "\nâœ… **No Policy Violations Found**"
}

---
*Generated by [ClearBOM](https://github.com/ennachite/clearbom)*
`;
}
